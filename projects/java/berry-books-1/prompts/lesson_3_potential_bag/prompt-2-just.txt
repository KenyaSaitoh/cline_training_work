===============================================
潜在的不具合検出プロンプト【中：適切版】
===============================================

berry-books-1プロジェクトのソースコードから潜在的な不具合を以下の観点で検出してください。

## 検出項目

### 1. バリデーション関連
- 入力値検証の漏れ（必須チェック、形式チェック、範囲チェック等）
- Bean Validationアノテーションの不足や誤り
- 業務検証の漏れ

### 2. null安全性
- nullチェックの漏れ
- NullPointerExceptionが発生する可能性のある箇所
- Optional型の不適切な使用

### 3. 例外処理
- 例外ハンドリングの漏れ
- 不適切なcatchブロック（例外を握りつぶす、ログ出力なし等）
- リソースのクローズ漏れ

### 4. トランザクション
- トランザクション境界の設定漏れ
- @Transactionalの不適切な使用
- トランザクション属性の誤り

### 5. データ整合性
- 一意制約違反の可能性
- 外部キー制約違反の可能性
- データ不整合が発生する処理

### 6. 並行処理・排他制御
- 楽観的ロック・悲観的ロックの実装漏れ
- 楽観的ロックでの不適切なバージョン番号の使用（正しいタイミングのバージョンを使用しているか）
- 競合状態（Race Condition）が発生する可能性
- スレッドセーフでない処理

### 7. セキュリティ
- SQLインジェクションの可能性
- パスワードの平文保存
- 認証・認可の漏れ
- 個人情報の不適切な扱い

### 8. リソース管理
- メモリリークの可能性
- コネクションリークの可能性
- ファイルハンドルのクローズ漏れ

### 9. ロジックエラー
- 条件分岐の漏れ
- ループ処理の不具合
- 計算式の誤り
- 境界値の処理漏れ

### 10. その他
- マジックナンバー
- コードの重複
- 非推奨APIの使用
- パフォーマンス上の問題

各不具合について、以下の情報を含めて報告してください：
- ファイル名とクラス名
- 該当箇所（メソッド名、行番号）
- 問題の内容
- 発生し得る影響
- 修正の推奨方法

